{% extends "eboa_nav/eboa_nav.html" %}
{% block li_active_sources %}class="active"{% endblock %}
{% block div_active_sources %}active{% endblock %}
{% block sources_nav_content %}
<div>
  <a href="/eboa_nav/query-sources"><p class="fa fa-chevron-left"> Back to query sources</p></a>
</div>
{% set not_ingested_sources = sources|selectattr("ingestion_duration", "none")|list %}
{% if not_ingested_sources|length > 0 %}
<div class="panel panel-red">
  <div class="panel-heading">
    Table of not ingested sources
  </div>
  <!-- /.panel-heading -->
  <div class="panel-body">
    <table width="100%" class="table table-striped table-bordered table-hover table-search" id="sources">
      <thead>
        <tr>
          <th>Name</th>
          <th>Validity start</th>
          <th>Validity stop</th>
          <th>Duration (s)</th>
          <th>Generation time</th>
          <th>DIM signature</th>
          <th>Processor</th>
          <th>Version</th>
          <th>UUID</th>
        </tr>
      </thead>
      <tbody>
        {% for source in not_ingested_sources %}
        <tr>
          <td>{{ source.name }}</td>
          <td>{{ source.validity_start }}</td>
          <td>{{ source.validity_stop }}</td>
          <td>{{ (source.validity_stop - source.validity_start).total_seconds() }}</td>
          <td>{{ source.generation_time }}</td>
          <td>{{ source.dimSignature.dim_signature }}</td>
          <td>{{ source.processor }}</td>
          <td>{{ source.processor_version }}</td>
          <td>{{ source.source_uuid }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th>Name</th>
          <th>Validity start</th>
          <th>Validity stop</th>
          <th>Duration (s)</th>
          <th>Generation time</th>
          <th>DIM signature</th>
          <th>Processor</th>
          <th>Version</th>
          <th>UUID</th>
        </tr>
      </tfoot>
    </table>
  </div>
  <!-- /.panel-body -->
</div>
<!-- /.panel -->
{% endif %}
<div class="panel panel-green">
  <div class="panel-heading">
    Table of ingested sources
  </div>
  <!-- /.panel-heading -->
  <div class="panel-body">
    <table width="100%" class="table table-striped table-bordered table-hover table-search" id="sources">
      <thead>
        <tr>
          <th>Name</th>
          <th>Validity start</th>
          <th>Validity stop</th>
          <th>Duration (s)</th>
          <th>Generation time</th>
          <th>Ingestion Time</th>
          <th>Ingestion Duration</th>
          <th>DIM signature</th>
          <th>Processor</th>
          <th>Version</th>
          <th>UUID</th>
        </tr>
      </thead>
      <tbody>
        {% for source in sources if source.ingestion_duration %}
        <tr>
          <td>{{ source.name }}</td>
          <td>{{ source.validity_start }}</td>
          <td>{{ source.validity_stop }}</td>
          <td>{{ (source.validity_stop - source.validity_start).total_seconds() }}</td>
          <td>{{ source.generation_time }}</td>
          <td>{{ source.ingestion_time }}</td>
          <td>{{ source.ingestion_duration }}</td>
          <td>{{ source.dimSignature.dim_signature }}</td>
          <td>{{ source.processor }}</td>
          <td>{{ source.processor_version }}</td>
          <td>{{ source.source_uuid }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th>Name</th>
          <th>Validity start</th>
          <th>Validity stop</th>
          <th>Duration (s)</th>
          <th>Generation time</th>
          <th>Ingestion Time</th>
          <th>Ingestion Duration</th>
          <th>DIM signature</th>
          <th>Processor</th>
          <th>Version</th>
          <th>UUID</th>
        </tr>
      </tfoot>
    </table>
  </div>
  <!-- /.panel-body -->
</div>
<!-- /.panel -->
{% if not show or show["validity_timeline"] %}
<div class="panel panel-default">
  <div class="panel-heading">
    Validity timeline of sources
  </div>
  <!-- /.panel-heading -->
  <div class="panel-body">
    <div id="sources_nav_validity_timeline">
    </div>
  </div>
  <!-- /.panel-body -->
</div>
<!-- /.panel -->
{% endif %}
{% if not show or show["generation_to_ingestion_timeline"] %}
<div class="panel panel-default">
  <div class="panel-heading">
    Generation to ingestion timeline of sources
  </div>
  <!-- /.panel-heading -->
  <div class="panel-body">
    <div id="sources_nav_generation_to_ingestion_timeline">
    </div>
  </div>
  <!-- /.panel-body -->
</div>
<!-- /.panel -->
{% endif %}
{% if not show or show["number_events_xy"] %}
<div class="panel panel-default">
  <div class="panel-heading">
    Number of events over time per source
  </div>
  <!-- /.panel-heading -->
  <div class="panel-body">
    <div id="sources_nav_number_events_xy">
    </div>
  </div>
  <!-- /.panel-body -->
</div>
<!-- /.panel -->
{% endif %}
{% if not show or show["ingestion_duration_xy"] %}
<div class="panel panel-default">
  <div class="panel-heading">
    Ingestion duration over time per source
  </div>
  <!-- /.panel-heading -->
  <div class="panel-body">
    <div id="sources_nav_ingestion_duration_xy">
    </div>
  </div>
  <!-- /.panel-body -->
</div>
<!-- /.panel -->
{% endif %}
{% if not show or show["generation_time_to_ingestion_time_xy"] %}
<div class="panel panel-default">
  <div class="panel-heading">
    Difference between the ingestion time and the generation time over time per source
  </div>
  <!-- /.panel-heading -->
  <div class="panel-body">
    <div id="sources_nav_generation_time_to_ingestion_time_xy">
    </div>
  </div>
  <!-- /.panel-body -->
</div>
<!-- /.panel -->
{% endif %}
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script type="text/javascript">
      {% with sources=sources %}
      {% include "graphs/sources_to_json.js" %}
      {% endwith %}
      {% if not show or show["validity_timeline"] %}
      vboa.create_source_validity_timeline(sources, "sources_nav_validity_timeline");
      {% endif %}
      {% if not show or show["generation_to_ingestion_timeline"] %}
      vboa.create_source_generation_to_ingestion_timeline(sources, "sources_nav_generation_to_ingestion_timeline");
      {% endif %}
      {% if not show or show["number_events_xy"] %}
      vboa.create_source_number_events_xy(sources, "sources_nav_number_events_xy");
      {% endif %}
      {% if not show or show["ingestion_duration_xy"] %}
      vboa.create_source_ingestion_duration_xy(sources, "sources_nav_ingestion_duration_xy");
      {% endif %}
      {% if not show or show["generation_time_to_ingestion_time_xy"] %}
      vboa.create_source_generation_time_to_ingestion_time_xy(sources, "sources_nav_generation_time_to_ingestion_time_xy");
      {% endif %}
    </script>
{% endblock %}
